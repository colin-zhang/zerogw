containers:

  ubuntu:
    setup:
    - !Ubuntu trusty
    - !UbuntuUniverse ~
    - !Install
      # runtime dependencies
      - libzmq1
      # for "git describe"
      - git
      # build dependendies
      - gcc
      - make
      - libzmq-dbg
      - libzmq-dev
      - libyaml-dev
      - libev-dev
      - libssl-dev
      - python3
      - python3-yaml
      # for packaging
      - checkinstall


commands:

  waf: !Command
    description: The generic waf command
    container: ubuntu
    run: ["./waf"]

  build-ubuntu-package: !Command
    description: Create an ubuntu (.deb) package using checkinstall in
      container
    container: ubuntu
    write-mode: transient-hard-link-copy
    run: |
      set -ex
      #
      python3 ./waf configure --prefix=/usr
      python3 ./waf build
      #
      checkinstall \
        --default \
        --maintainer=paul@colomiets.name \
        --pkglicense=MIT \
        --pkgname=zerogw \
        --requires="libev4, libyaml-0-2, libzmq1" \
        --pkgver=${1:-$(git describe | cut -c2-)} \
        --nodoc \
      python3 ./waf install
